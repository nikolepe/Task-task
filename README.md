# Task-task
Настройка сервисов на сервере. Nginx, Apache, PHP, MySql, PhpMyadmin. Настройка площадок для работы сайта.
## Задача
Настройка сервисов на сервере. Требуется провести более тонкую настройку отдельных сервисов. Результат данной работы должен выглядеть как diff-файл между стандартными настройками сервисов и доработанными в ходе тестового задания. Желательно приложить каталог с конфигурацией изменяемого сервиса.

Задание по настройке Nginx:
Настроить сжатие типов данных: text, javascript, css, json, xml.
Разрешить максимальную загрузку данных через Nginx в соответствии с настройками PHP.
Запретить вывод версии Nginx (при web-запросах к сайтам сервера).

Задание по настройке Apache:
Запретить (глобально) возможность обращения пользователей к директориям вида .svn и .git.
Настроить работу Apache по 81 порту на локальном IP-адресе.
Уменьшить максимальное количество клиентов веб-сервера до 25.

Задание по настройке PHP:
Настроить параметры хранения сессий PHP таким образом, чтобы сессии сайтов жили минимум 1 сутки.
После этого, с вероятностью 10%, сессии должны очищаться.
Разрешить загрузку файлов через PHP с максимальным объемом - 64 Мб.

Задание по настройке MySQL:
Выделить для кэша запросов 32 Мб ОЗУ.
Размер временных таблиц установить в 50 Мб.
Количество кэшированных потоков (нитей) должно быть не ниже 20.
Все InnoDB-таблицы должны храниться в отдельных файлах.
Настройка площадок на сервере. По результатам работы должно получиться 2 площадки под сайты, которые будут обслуживать сайты (site.ru и site-2.ru). Также должен работать PMA как алиас к обоим площадкам.

Задание по настройке площадки для работы сайта site.ru:
Необходимо настроить связку Nginx+Apache2+PHP+MySQL для работы сайта (site.ru).
На сервере подготовить площадку под сайт и развернуть в рамках неё CMS Битрикс.
Настроить web-сервер таким образом, чтобы все запросы к статическим данным, таким как изображения, видео, gif и др, обрабатывались Nginx, а все остальные - передавались на обработку Apache2.
При этом, все подобные запросы, которые Nginx должен был, но по каким-то причинам не смог обработать самостоятельно, должны передаваться на Apache2.
Настроить минимально необходимые для работы Nginx и Apache права на площадку для сайта.

Задание по настройке площадки для работы сайта site-2.ru:
Необходимо настроить связку Nginx+php-fpm для работы сайта (site-2.ru).
Необходимо предусмотреть возможность переключения между версиями PHP через разные пулы fpm.
Сайт должен работать от пользователя site-2.ru.
Установить на площадке любой файл-менеджер на PHP.
Загрузить/удалить с его помощью несколько файлов внутрь сайта (статических (картинки) и динамических файлов (например phpinfo)).
Проверить корректность доступа к загруженным файлам.

Задание по настройке phpMyAdmin как алиас:
phpMyAdmin должен работать для любого сайта сервера - простым добавлением /phpmyadmin к URL сайта (PMA как алиас).
phpMyAdmin должен быть последней версии, скачанный с официального сайта.
Обеспечить работу phpMyAdmin (без ошибок и предупреждений) и возможность управления базами данных MySQL на данном сервере.
Обеспечить возможность работы "дополнительных возможностей" PMA.
Статические данные PMA должны отдаваться веб-сервером Nginx.

Результат выполнения тестового задания: Ссылка на облачное хранилище, где хранится файл .tar.gz, содержащий директории и файлы с настройками (основные директории сервисов, которые подверглись модификации), а также структуру каталогов и файлов (в /var/www/) для проверки созданных связок. Если с Вашей стороны возникнут какие-либо комментарии к заданию - Вы можете описать их в письме, или вложить файл read.me.

Ремарка: Площадка под сайт представляет директорию в /var/www/, в которой содержатся:

Отдельная директория для кода сайта (DOC_ROOT).
Отдельная структура директорий для хранения логов сайта.
Отдельная директория для хранения сессий сайта.
Отдельная директория для хранения временных файлов сайта.
Тестовое задание необходимо выполнить в ОС Debian/Ubuntu/CentOS.

## Ход выполнения
Предварительная установка программ (nginx, apache2, php, php-fpm, php-mysql, mysql-server)
Копирование конфигурационных файлов в их первоначальном виде в папку /etc/backup-configs
Настройка nginx. Изменение файла /etc/nginx/nginx.conf
Настройка Apache. Изменение файлов /etc/apache2/apache2.conf; /etc/apache2/ports.conf; /etc/apache2/sites-available/000-default.conf; /etc/apache2/mods-available/mpm_pworker.conf
Настройка Mysql. Изменение файла /etc/mysql/my.cnf. Не добавил query_cache_size, так как начиная с версии mysql 8.0 кэш запросов был удален. При попытке откатить версию до 5.7 вылезала ошибка во время распаковки одного из пакетов.
Настройка площадки для работы сайта site.ru. Создал директории, выдал права. Настроил файлы /etc/nginx/sites-available/site.ru, /etc/apache2/sites-available/site.ru.conf, активировал конфигурацию, сайт заработал. Скачал Битрикс с оф.сайта, распаковал. Чтобы мой сайт откылся, исправил в /php.ini команду short_open_tag на On. Во время предварительной проверки исправил несколько параметров(mod_rewrite, date.timezone, opcache.revalidate_freq(см. файл .htaccess)). Создал базу данных bitrix_db через mysql. Развернул 1-С Битрикс туда.
Настройка площадки для работы site-2.ru. Создал директории, выдал права. Настроил файл /etc/nginx/sites-available/site-2.ru. Активировал конфигурацию, запустил сайт. Скачал архив с файловым менеджером, распаковал, закинул filemanager.php в DOC_ROOT. Настроил конфигурацию, чтобы сайт автоматически перенаправлял на этот менеджер. Загрузка, удаление, скачивание файлов проходит успешно.
Настройка phpmyadmin. Скачал архив, распаковал в директории каждого сайта (DOC_ROOT), выдал права. Изменил конфигурацию этих сайтов /etc/nginx/sites-available/site.ru(site-2.ru). Установил полные права в mysql для пользователя nikita@localhost, чтобы беспрепятственно работать с БД. 
